用户特征汇总：
1：用户行为小时数               (可以做)
2：用户总点击数              (done)
3：用户收藏次数               (done)
4：用户购买次数                (done)
5：用户购买产品类别 分布。      ()
6：用户活跃小时数                   (可以做，只算浏览记录，不用算收藏，购买)
7：用户的重复购买率(周期行为，消耗品)
8：用户最后活跃事件                
9：用户主要购买时间分布      (done)
10：用户未经收藏或购物车直接购买次数(分析点击次数)  (done)
11：用户购买平均点击次数  ()
12：无购买记录但有交互的用户。
13：所有的购买的用户行为集合。
14:购物车转换率。                       (done)
15：新用户的增加。即之前没有买过，只有行为记录，然后在19号会开始买东西
16:用户点击总小时。                     (可以做)
17：用户收藏总小时                     (可以不做。)
18:用户购买总小时                      (可以做)
19:用户平均购买间隔小时数                 (可以做)
20：点击购买比                          (done)


用户产品交叉特征汇总：
21：用户从最初有记录行为到最近一次购买该产品的平均小时数。 (可以做)
22：用户行为期间平均每小时点击数。                         (可以做)
23：用户行为期间每小时平均收藏次数                         (收藏次数很少，所以可以不做)
24: 
25：用户对item第一次交互离现在的天数。(不做)
26: 用户对item最后一次交互离现在的天数。(不做)
27: 用户的点击购买比。
28：用户的总点击小时数                (可以做)
29：用户购买总小时数。                (可以做)
30：用户对item第一次购买前的加购物车次数。(难以实现)
32：用户对item第一次购买前的加收藏次数      (难以实现)
44：用户对item的购买是否属于他偏好的产品类别。

产品特征汇总：
33:item 被购买的总次数
34:item 被收藏的总次数
35:item 被加入购物车的总次数
36:item 点击购买比值
37:item 点击购买比值
38:item 被购买的天数 (弱特征。可能没有信息量。每天都有人买他) 
39:购买过item后再次购买这个item的类别的其他item的次数(按时间划分)



以上特征可按时间划分出 3/7/13/25 天时间轴特征。

以上特征多数忽略了全局趋势对用户的影响。
所以加入一些总体用户行为趋势对单个用户的影响。

40：用户A对item的点击占item总点击量的比。
41：用户对一个类别的购买占到了整个类别的购买比值
42：产品类别的热门度(自定义热门度)
43:产品的热门度(自定义热门度)


接下来进行特征计算


1：
6：用户活跃小时数                   (可以做，只算浏览记录，不用算收藏，购买)
16:用户点击总小时。                     (可以做)
18:用户购买总小时                      (可以做)
19:用户平均购买间隔小时数                 (mapreduce 坐不了)
21：用户从最初有记录行为到最近一次购买该产品的平均小时数。 (坐不了)
22：用户行为期间平均每小时点击数。                         (可以做)

用户对类别的喜欢程度。
点击数*0.1+购买数*2+购物车数+收藏数
用户对产品的喜欢程度
点击数*0.1+购买数*5+购物车数+收藏数
(全局考量)
用户的兴趣
他对这个产品的总点击率占他所有行为总记录的比值。

购买力定义: 购买数量 - 0.01*click_times

逻辑回归 只有400条正确数据。


新晋特征：
最近一次加购物车离预测天的天数。(重要)
最近一次购买离预测天的天数       (重要)
最近一次浏览离预测天的天数      (重要)
最近一次收藏离预测天的天数      
(用户A对品牌B的点击数-用户A对操作过的品牌的平均点击数)/用户A对操作过的品牌的平均点击数
(用户A对品牌B的购买数-用户A对操作过的品牌的平均购买数)/用户A对操作过的品牌的平均购买数
(用户A对品牌B的收藏数-品牌B被平均收藏数)/品牌B被平均收藏数

用户的偏好可以通过减去平均来简单表示


三个mapreduce:
user-item ：算当个用户对item的信息，可以得到的信息有
1：用户对item 的点击次数，收藏次数，购买次数，购物车次数。(时间衰减) (done)
2：用户对item的点击平均时间间隔，收藏间隔，购买间隔.(bad，经测试差，效果)
3：用户最近一次点击，收藏，加购物车，购买距离现在的时间。
4：用户对当前item的偏好：
   （用户对此item点击-用户平均对item平均点击次数）
    (用户对此item的收藏，购买 - 用户对item的平均收藏，购买，购物车次数)


截止到最后一天，用户对品牌进行第一次访问（收藏、购物车、购买）到最后一次访问的时间间隔（或经过时间衰减）
用户A对品牌B的点击次数占用户A总点击次数的比例.

用户A对品牌B的各次购买离现在的平均天数(先不做)
用户A对品牌B的第一次购买前的点击数    (先不做)
用户购买后对item的点击                 (先不做)


item_Mapreduce:
1：item总共被浏览，收藏，购物车，购买的次数。
2：item平均浏览，收藏，购物车，购买次数(按用户算)
3：item的回头率。老客户数。
4购买人数/访问人数

用户总共浏览,收藏，加购物车过 多少个itemid,category_id,
用户对一个item，category,平均浏览，收藏，加购物车多少次。
用户对item的偏好。对他的1*(浏览-用户平均的浏览次数)+2*(收藏-平均收藏)+3*(购物车-平均购物车)

category_mapredcue
1:category 总共被浏览，收藏，购物车，购买的次数
2：category 人均的 1 2 3 4次数
用户对这个category的偏好。

train_info


2.3 比值类特征
A．返客率（某一周期内多次购买的用户数/总购买用户数）
B．老客户率（3天【或其他周期7、15、30】前曾购买过且在前3天内再次购买的用户数/3天内总购买用户数）
分别再针对收藏、购物车、点击等操作构建上述2个特征。
P.S.：这里返客率和老客户率均不含124这个周期。
C．跳出率（周期内只对品牌进行过1次点击操作的用户数/总用户数）
D．活跃度（周期内有3次及以上点击的用户数/总用户数）
E．人均点击数、人均购买量、人均收藏量、人均购物车量等
F．不在初次访问品牌时进行购买的订单数/总订单数（以此获得品牌在下个月被购买的可能性）

item_id-time



训练集的采取。
11-23 号到 11-30. 
测试集的采取：12-1号这天的购买数据

数据预处理：
1：出去爬虫用户，就是没有购买和点击率在前20名的用户。清除数据为(有1260596条数据)
2:去掉高值后也去掉低值。去掉总行为次数低于10次的。

特征整理：
用户行为类：
1：用户的总点击次数。
2：用户的总收藏次数
3：用户的总加购物车次数
4：用户的总购买次数

购物车有50上限
一个item可能被买7000次最多
购物车的偏好程度：
1：加购物车在在购买之前

2:加购物车在购买之后

3:加购物车但是买了同类别的其他产品。

4：加购物车然后买了这件产品。



------------------------------------------------
已经提取的特征。
1： 1 2 3 4 的次数
2： 1 2 3 4 的衰减次数 (权重随时间变化)
3:  1 4 小时数
4:  平均点击次数 (每小时)
5:  1 2 3 4 上次操作距离现在的时间

C．跳出率（周期内只对品牌进行过1次点击操作的用户数/总用户数）
D．活跃度（周期内有3次及以上点击的用户数/总用户数）
E．人均点击数、人均购买量、人均收藏量、人均购物车量等

1:category 总共被浏览，收藏，购物车，购买的次数
2：category 人均的 1 2 3 4次数
   用户对这个category的偏好。

1：item总共被浏览，收藏，购物车，购买的次数。
2：item平均浏览，收藏，购物车，购买次数(按用户算)
3：item的回头率。老客户数。
4购买人数/访问人数

购物车的喜欢程度

最近的购买欲望。


2天的 1 2 3 4 次数。           //
2天访问的item,category 次数
用户最近一次购买距离现在的时间      //
用户这两天的点击次数，收藏次数，浏览次数

这两天的活跃程度，可以用这两天的点击，收藏等，除以9天的总。
每个类的购物车转化率

item_preference: